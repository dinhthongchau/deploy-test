var pt=i=>{throw TypeError(i)};var Y=(i,t,s)=>t.has(i)||pt("Cannot "+s);var e=(i,t,s)=>(Y(i,t,"read from private field"),s?s.call(i):t.get(i)),p=(i,t,s)=>t.has(i)?pt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,s),u=(i,t,s,r)=>(Y(i,t,"write to private field"),r?r.call(i,s):t.set(i,s),s),f=(i,t,s)=>(Y(i,t,"access private method"),s);import{S as Qt,p as bt,e as E,s as et,f as J,n as Ft,i as mt,g as vt,t as Dt,h as Ut,j as Lt,k as gt,l as Tt,m as kt,q as xt,u as q,v as Mt,x as _t,y as yt,z as Rt,A as Pt,B as jt,C as Z,D as K,c as $,a as G,d as Bt,E as At,F as zt,G as Nt,o as tt}from"./index-D18SQbBF.js";import{u as It,a as Ct,C as Vt}from"./ContactForm-DRJuYSVM.js";var g,a,V,v,U,j,F,O,W,B,A,L,T,D,z,c,N,st,it,nt,rt,at,ot,ct,wt,Et,Wt=(Et=class extends Qt{constructor(t,s){super();p(this,c);p(this,g);p(this,a);p(this,V);p(this,v);p(this,U);p(this,j);p(this,F);p(this,O);p(this,W);p(this,B);p(this,A);p(this,L);p(this,T);p(this,D);p(this,z,new Set);this.options=s,u(this,g,t),u(this,O,null),u(this,F,bt()),this.options.experimental_prefetchInRender||e(this,F).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(e(this,a).addObserver(this),St(e(this,a),this.options)?f(this,c,N).call(this):this.updateResult(),f(this,c,rt).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ht(e(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ht(e(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,c,at).call(this),f(this,c,ot).call(this),e(this,a).removeObserver(this)}setOptions(t,s){const r=this.options,h=e(this,a);if(this.options=e(this,g).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,e(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,c,ct).call(this),e(this,a).setOptions(this.options),r._defaulted&&!et(this.options,r)&&e(this,g).getQueryCache().notify({type:"observerOptionsUpdated",query:e(this,a),observer:this});const o=this.hasListeners();o&&Ot(e(this,a),h,this.options,r)&&f(this,c,N).call(this),this.updateResult(s),o&&(e(this,a)!==h||E(this.options.enabled,e(this,a))!==E(r.enabled,e(this,a))||J(this.options.staleTime,e(this,a))!==J(r.staleTime,e(this,a)))&&f(this,c,st).call(this);const l=f(this,c,it).call(this);o&&(e(this,a)!==h||E(this.options.enabled,e(this,a))!==E(r.enabled,e(this,a))||l!==e(this,D))&&f(this,c,nt).call(this,l)}getOptimisticResult(t){const s=e(this,g).getQueryCache().build(e(this,g),t),r=this.createResult(s,t);return qt(this,r)&&(u(this,v,r),u(this,j,this.options),u(this,U,e(this,a).state)),r}getCurrentResult(){return e(this,v)}trackResult(t,s){const r={};return Object.keys(t).forEach(h=>{Object.defineProperty(r,h,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(h),s==null||s(h),t[h])})}),r}trackProp(t){e(this,z).add(t)}getCurrentQuery(){return e(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=e(this,g).defaultQueryOptions(t),r=e(this,g).getQueryCache().build(e(this,g),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(t){return f(this,c,N).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),e(this,v)))}createResult(t,s){var ft;const r=e(this,a),h=this.options,o=e(this,v),l=e(this,U),y=e(this,j),Q=t!==r?t.state:e(this,V),{state:R}=t;let d={...R},w=!1,n;if(s._optimisticResults){const m=this.hasListeners(),_=!m&&St(t,s),P=m&&Ot(t,r,s,h);(_||P)&&(d={...d,...Lt(R.data,t.options)}),s._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:b,errorUpdatedAt:k,status:C}=d;if(s.select&&d.data!==void 0)if(o&&d.data===(l==null?void 0:l.data)&&s.select===e(this,W))n=e(this,B);else try{u(this,W,s.select),n=s.select(d.data),n=gt(o==null?void 0:o.data,n,s),u(this,B,n),u(this,O,null)}catch(m){u(this,O,m)}else n=d.data;if(s.placeholderData!==void 0&&n===void 0&&C==="pending"){let m;if(o!=null&&o.isPlaceholderData&&s.placeholderData===(y==null?void 0:y.placeholderData))m=o.data;else if(m=typeof s.placeholderData=="function"?s.placeholderData((ft=e(this,A))==null?void 0:ft.state.data,e(this,A)):s.placeholderData,s.select&&m!==void 0)try{m=s.select(m),u(this,O,null)}catch(_){u(this,O,_)}m!==void 0&&(C="success",n=gt(o==null?void 0:o.data,m,s),w=!0)}e(this,O)&&(b=e(this,O),n=e(this,B),k=Date.now(),C="error");const x=d.fetchStatus==="fetching",M=C==="pending",X=C==="error",lt=M&&x,dt=n!==void 0,S={status:C,fetchStatus:d.fetchStatus,isPending:M,isSuccess:C==="success",isError:X,isInitialLoading:lt,isLoading:lt,data:n,dataUpdatedAt:d.dataUpdatedAt,error:b,errorUpdatedAt:k,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>Q.dataUpdateCount||d.errorUpdateCount>Q.errorUpdateCount,isFetching:x,isRefetching:x&&!M,isLoadingError:X&&!dt,isPaused:d.fetchStatus==="paused",isPlaceholderData:w,isRefetchError:X&&dt,isStale:ut(t,s),refetch:this.refetch,promise:e(this,F)};if(this.options.experimental_prefetchInRender){const m=H=>{S.status==="error"?H.reject(S.error):S.data!==void 0&&H.resolve(S.data)},_=()=>{const H=u(this,F,S.promise=bt());m(H)},P=e(this,F);switch(P.status){case"pending":t.queryHash===r.queryHash&&m(P);break;case"fulfilled":(S.status==="error"||S.data!==P.value)&&_();break;case"rejected":(S.status!=="error"||S.error!==P.reason)&&_();break}}return S}updateResult(t){const s=e(this,v),r=this.createResult(e(this,a),this.options);if(u(this,U,e(this,a).state),u(this,j,this.options),e(this,U).data!==void 0&&u(this,A,e(this,a)),et(r,s))return;u(this,v,r);const h={},o=()=>{if(!s)return!0;const{notifyOnChangeProps:l}=this.options,y=typeof l=="function"?l():l;if(y==="all"||!y&&!e(this,z).size)return!0;const I=new Set(y??e(this,z));return this.options.throwOnError&&I.add("error"),Object.keys(e(this,v)).some(Q=>{const R=Q;return e(this,v)[R]!==s[R]&&I.has(R)})};(t==null?void 0:t.listeners)!==!1&&o()&&(h.listeners=!0),f(this,c,wt).call(this,{...h,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,c,rt).call(this)}},g=new WeakMap,a=new WeakMap,V=new WeakMap,v=new WeakMap,U=new WeakMap,j=new WeakMap,F=new WeakMap,O=new WeakMap,W=new WeakMap,B=new WeakMap,A=new WeakMap,L=new WeakMap,T=new WeakMap,D=new WeakMap,z=new WeakMap,c=new WeakSet,N=function(t){f(this,c,ct).call(this);let s=e(this,a).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(Ft)),s},st=function(){f(this,c,at).call(this);const t=J(this.options.staleTime,e(this,a));if(mt||e(this,v).isStale||!vt(t))return;const r=Dt(e(this,v).dataUpdatedAt,t)+1;u(this,L,setTimeout(()=>{e(this,v).isStale||this.updateResult()},r))},it=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(e(this,a)):this.options.refetchInterval)??!1},nt=function(t){f(this,c,ot).call(this),u(this,D,t),!(mt||E(this.options.enabled,e(this,a))===!1||!vt(e(this,D))||e(this,D)===0)&&u(this,T,setInterval(()=>{(this.options.refetchIntervalInBackground||Ut.isFocused())&&f(this,c,N).call(this)},e(this,D)))},rt=function(){f(this,c,st).call(this),f(this,c,nt).call(this,f(this,c,it).call(this))},at=function(){e(this,L)&&(clearTimeout(e(this,L)),u(this,L,void 0))},ot=function(){e(this,T)&&(clearInterval(e(this,T)),u(this,T,void 0))},ct=function(){const t=e(this,g).getQueryCache().build(e(this,g),this.options);if(t===e(this,a))return;const s=e(this,a);u(this,a,t),u(this,V,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},wt=function(t){Tt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(e(this,v))}),e(this,g).getQueryCache().notify({query:e(this,a),type:"observerResultsUpdated"})})},Et);function Ht(i,t){return E(t.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&t.retryOnMount===!1)}function St(i,t){return Ht(i,t)||i.state.data!==void 0&&ht(i,t,t.refetchOnMount)}function ht(i,t,s){if(E(t.enabled,i)!==!1){const r=typeof s=="function"?s(i):s;return r==="always"||r!==!1&&ut(i,t)}return!1}function Ot(i,t,s,r){return(i!==t||E(r.enabled,i)===!1)&&(!s.suspense||i.state.status!=="error")&&ut(i,s)}function ut(i,t){return E(t.enabled,i)!==!1&&i.isStaleByTime(J(t.staleTime,i))}function qt(i,t){return!et(i.getCurrentResult(),t)}function Kt(i,t,s){const r=It(),h=kt(()=>{const n=_t(t);typeof n.enabled=="function"&&(n.enabled=n.enabled());const b=r.defaultQueryOptions(n);return b._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",b}),o=new i(r,h.value),l=xt(o.getCurrentResult());let y=()=>{};q(r.isRestoring,n=>{n||(y(),y=o.subscribe(b=>{yt(l,b)}))},{immediate:!0});const I=()=>{o.setOptions(h.value),yt(l,o.getCurrentResult())};q(h,I),Pt(()=>{y()});const Q=(...n)=>(I(),l.refetch(...n)),R=()=>new Promise((n,b)=>{let k=()=>{};const C=()=>{if(h.value.enabled!==!1){o.setOptions(h.value);const x=o.getOptimisticResult(h.value);x.isStale?(k(),o.fetchOptimistic(h.value).then(n,M=>{Rt(h.value.throwOnError,[M,o.getCurrentQuery()])?b(M):n(o.getCurrentResult())})):(k(),n(x))}};C(),k=q(h,C)});q(()=>l.error,n=>{if(l.isError&&!l.isFetching&&Rt(h.value.throwOnError,[n,o.getCurrentQuery()]))throw n});const w=Mt(l);for(const n in l)typeof l[n]=="function"&&(w[n]=l[n]);return w.suspense=R,w.refetch=Q,w}function Gt(i,t){return Kt(Wt,i)}const Jt={key:0,class:"page"},Xt={key:1},Yt={key:2},se={__name:"ContactEdit",props:{contactId:{type:String,required:!0}},setup(i){const t=i,s=zt(),r=Nt(),h=It(),o=jt(""),{data:l,isError:y,isLoading:I}=Gt({queryKey:["contact",t.contactId],queryFn:()=>Z.fetchContact(t.contactId),onError:n=>{console.error("Error fetching contact:",n),s.push({name:"notfound",params:{pathMatch:r.path.split("/").slice(1)},query:r.query,hash:r.hash})}}),Q=Ct({mutationFn:n=>Z.updateContact(t.contactId,n),onSuccess:()=>{o.value="Liên hệ được cập nhật thành công.",console.log("Contact updated successfully"),h.invalidateQueries(["contact",t.contactId])},onError:n=>{console.error("Error updating contact:",n),o.value="Lỗi cập nhật Liên hệ."}}),R=Ct({mutationFn:n=>Z.deleteContact(n),onSuccess:()=>{console.log("Contact deleted successfully"),s.push({name:"contactbook"})},onError:n=>{console.error("Error deleting contact:",n)}}),d=n=>{console.log("Updating contact:",n),Q.mutate(n)},w=()=>{confirm("Bạn muốn xóa Liên hệ này?")&&R.mutate(t.contactId)};return(n,b)=>!K(I)&&!K(y)?(tt(),$("div",Jt,[b[0]||(b[0]=G("h4",null,"Hiệu chỉnh Liên hệ",-1)),Bt(Vt,{contact:K(l),"onSubmit:contact":d,"onDelete:contact":w},null,8,["contact"]),G("p",null,At(o.value),1)])):K(I)?(tt(),$("div",Xt,b[1]||(b[1]=[G("p",null,"Đang tải dữ liệu...",-1)]))):(tt(),$("div",Yt,b[2]||(b[2]=[G("p",null,"Có lỗi xảy ra khi tải Liên hệ.",-1)])))}};export{se as default};
